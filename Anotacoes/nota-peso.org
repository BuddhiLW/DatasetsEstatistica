#+LATEX_COMPILER: xelatex

#+STARTUP: latexpreview

#+LATEX_HEADER: \hypersetup{colorlinks, allcolors=., colorlinks=true,linkcolor={blue!78!white}, urlcolor={purple}, filecolor={winered}}

#+LATEX_HEADER:\usepackage{xcolor} % to access the named colour LightGray
#+LATEX_HEADER:\definecolor{LightGray}{gray}{0.2}
#+LATEX_HEADER:\usepackage{minted}
#+LATEX_HEADER:\usemintedstyle{monokai}

* [[https://www.sheffield.ac.uk/mash/statistics/datasets][Peso ao Nascimento]]
+ *Modelar peso ao nascimento (libras) (=Birthweight=) a partir das variáveis*.
** Dados sobre o =Conjunto=
 + Dados:
   - lowbwt: baixo peso ao nascer. 
   - ID: Identificador
   - mage35: mãe mais velha do que 35 anos.
   - fnocig: número de cigarros fumado pelo pai diariamente.
   - fheight: peso do pai (kg)
   - fedyrs: quantidade de anos de educação do pai
   - fage: idade do pai
   - mppwt: peso da mãe pré gravidez.
   - mheight: tamanho da mãe (cm).
   - mnocig: número de cigarros fumados diariamente pela mãe.
   - Motherage: idade da mãe.
   - Gestation: tempo de gestação.
   - smoker: fumante durante gestação 
   - headcirumfer: circunferência da cabeça
   - length: tamanho (cm)
** Invocação de conjuto, por arquivo local

Dado que você copiou os conjunto(s) de dado(s) para um diretório
local, pode-se chamar o conjunto [[https://drive.google.com/file/d/1xv2lCPsj04FjGPQ_BgPS9mrTIjBcyHQk/view?usp=sharing][Birth Weight]] da seguinte maneira.

#+NAME: 519ad885-d8f2-4153-9b20-99c586730210
#+begin_src ein-r :session localhost :results output :eval :exports both
  data <- read.csv('../data/csv/Birthweight_reduced_kg_R.csv')
  head(data,5)
#+end_src

#+RESULTS: 519ad885-d8f2-4153-9b20-99c586730210
#+begin_example
  ID   Length Birthweight Headcirc Gestation smoker mage mnocig mheight mppwt
1 1360 56     4.55        34       44        0      20   0      162     57   
2 1016 53     4.32        36       40        0      19   0      171     62   
3  462 58     4.10        39       41        0      35   0      172     58   
4 1187 53     4.07        38       44        0      20   0      174     68   
5  553 54     3.94        37       42        0      24   0      175     66   
  fage fedyrs fnocig fheight lowbwt mage35
1 23   10     35     179     0      0     
2 19   12      0     183     0      0     
3 31   16     25     185     0      1     
4 26   14     25     189     0      0     
5 30   12      0     184     0      0     
#+end_example

** Matrix Corelação (exploratório)
*** Biblioteca ggplot para correlações
#+NAME: dadda977-b446-4f5d-95e7-647fc7f55abe
#+begin_src ein-r :session localhost :results output :eval
  install.packages("ggcorrplot")                      # Install ggcorrplot package
  library("ggcorrplot")
#+end_src

#+RESULTS: dadda977-b446-4f5d-95e7-647fc7f55abe
: 
: 

#+NAME: 19b6d3e3-f3bd-455f-882e-1bfb204854cd
#+begin_src ein-r :session localhost :results output :eval
  library("ggcorrplot")
#+end_src

#+RESULTS: 19b6d3e3-f3bd-455f-882e-1bfb204854cd
: 

*** Computação de Correlações
***** everything 
#+NAME: 1d88f5eb-f5a9-4233-9c39-aed8abfc481a
#+begin_src ein-r :session localhost :results output :eval
cor(data, use=c("everything"), method=c("pearson"))
#+end_src

#+RESULTS: 1d88f5eb-f5a9-4233-9c39-aed8abfc481a
#+begin_example
            ID          Length       Birthweight   Headcirc    Gestation   
ID           1.00000000  0.192635194  0.1112107085 -0.04489917  0.102714265
Length       0.19263519  1.000000000  0.7268334848  0.56317161  0.705110591
Birthweight  0.11121071  0.726833485  1.0000000000  0.68461562  0.708302894
Headcirc    -0.04489917  0.563171606  0.6846156185  1.00000000  0.404634772
Gestation    0.10271426  0.705110591  0.7083028937  0.40463477  1.000000000
smoker      -0.27618220 -0.153406153 -0.3142339464 -0.18287185 -0.094746078
mage        -0.18642559  0.075268357  0.0001731023  0.14584152  0.010778455
mnocig      -0.19462487 -0.039842761 -0.1523351845 -0.13298772  0.043194856
mheight     -0.01089325  0.484992403  0.3630551926  0.33704682  0.210503179
mppwt       -0.02651624  0.398197402  0.4008856280  0.30285407  0.255082369
fage        -0.23195803  0.137184365  0.1757099933  0.30115080  0.142175334
fedyrs       0.11992711  0.079484567  0.0710452258  0.12389250  0.130986636
fnocig      -0.11288857  0.008800476 -0.0931357623 -0.04683678 -0.113830614
fheight      0.08901791  0.208358435  0.0310224972  0.04150923  0.207596835
lowbwt      -0.12848315 -0.609928339 -0.6519637293 -0.44684892 -0.602934976
mage35      -0.26602100  0.130502048 -0.1089467536  0.05538561  0.007394508
            smoker        mage          mnocig      mheight       mppwt      
ID          -0.2761821977 -0.1864255867 -0.19462487 -0.0108932452 -0.02651624
Length      -0.1534061527  0.0752683574 -0.03984276  0.4849924026  0.39819740
Birthweight -0.3142339464  0.0001731023 -0.15233518  0.3630551926  0.40088563
Headcirc    -0.1828718541  0.1458415206 -0.13298772  0.3370468163  0.30285407
Gestation   -0.0947460785  0.0107784551  0.04319486  0.2105031792  0.25508237
smoker       1.0000000000  0.2124787863  0.72721809  0.0003532676  0.00000000
mage         0.2124787863  1.0000000000  0.34029438  0.0599563823  0.27416768
mnocig       0.7272180924  0.3402943777  1.00000000  0.1264388844  0.14894461
mheight      0.0003532676  0.0599563823  0.12643888  1.0000000000  0.68062174
mppwt        0.0000000000  0.2741676755  0.14894461  0.6806217412  1.00000000
fage         0.1975014481  0.8065844174  0.24842538 -0.0798698948  0.25570584
fedyrs      -0.0148905839  0.4416826598  0.19852620  0.0352970193  0.18037409
fnocig       0.4176329588  0.0909266363  0.25730739  0.0483980589  0.05716254
fheight      0.1106327308 -0.1995468633  0.02067224  0.2743379320  0.09298347
lowbwt       0.2530121569 -0.0763937244  0.03538366 -0.1981507848 -0.35397381
mage35       0.1469384534  0.6926638891  0.29057415  0.1160020427  0.13685344
            fage        fedyrs      fnocig       fheight     lowbwt     
ID          -0.23195803  0.11992711 -0.112888569  0.08901791 -0.12848315
Length       0.13718437  0.07948457  0.008800476  0.20835843 -0.60992834
Birthweight  0.17570999  0.07104523 -0.093135762  0.03102250 -0.65196373
Headcirc     0.30115080  0.12389250 -0.046836781  0.04150923 -0.44684892
Gestation    0.14217533  0.13098664 -0.113830614  0.20759684 -0.60293498
smoker       0.19750145 -0.01489058  0.417632959  0.11063273  0.25301216
mage         0.80658442  0.44168266  0.090926636 -0.19954686 -0.07639372
mnocig       0.24842538  0.19852620  0.257307386  0.02067224  0.03538366
mheight     -0.07986989  0.03529702  0.048398059  0.27433793 -0.19815078
mppwt        0.25570584  0.18037409  0.057162540  0.09298347 -0.35397381
fage         1.00000000  0.30047147  0.135862017 -0.26937685 -0.24509537
fedyrs       0.30047147  1.00000000 -0.263103019  0.01779765 -0.19127301
fnocig       0.13586202 -0.26310302  1.000000000  0.32936416  0.26601285
fheight     -0.26937685  0.01779765  0.329364159  1.00000000  0.09868772
lowbwt      -0.24509537 -0.19127301  0.266012851  0.09868772  1.00000000
mage35       0.35140504  0.27868203 -0.088989100 -0.18822971  0.09933993
            mage35      
ID          -0.266020997
Length       0.130502048
Birthweight -0.108946754
Headcirc     0.055385612
Gestation    0.007394508
smoker       0.146938453
mage         0.692663889
mnocig       0.290574154
mheight      0.116002043
mppwt        0.136853443
fage         0.351405036
fedyrs       0.278682026
fnocig      -0.088989100
fheight     -0.188229712
lowbwt       0.099339927
mage35       1.000000000
#+end_example

*** Respectivos plots
**** everything 
#+NAME: fde1a2b8-d06e-42bb-b344-08498e13dc12
#+begin_src ein-r :session localhost :results output :eval
ggcorrplot(cor(data, use=c("everything"), method=c("pearson")))
#+end_src

#+RESULTS: fde1a2b8-d06e-42bb-b344-08498e13dc12
#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-aa94cd69ce68aa1aee2b9ec8a1d335e1.png]]

** Visualização de cada variável QQ-plot
https://en.wikipedia.org/wiki/Q%E2%80%93Q_plot
*** Exemplo wikipedia
Exemplo de comportamento =exponencial= vs =normal=

#+ATTR_HTML: :width 300px
[[file:../img/450px-Normal_exponential_qq.svg.png]]

*** Biblioteca nativa qqplot
**** QQ entre duas variáveis
#+NAME: 30a56909-63fb-4975-b8c0-b17c66888994
#+begin_src ein-r :session localhost :results output :eval
  qqplot(data$Gestation, data$Birthweight, xlab = "test x", ylab = "test y", main = "Q-Q Plot")
#+end_src

#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-5682b4c4b8bc813218f8432da5bb9220.png]]

**** Contra uma normal

#+NAME: 653ff48a-e2d1-497d-8955-baee1b2c255d
#+begin_src ein-r :session localhost :results output :eval
qqnorm(data$Gestation, pch = 1, frame = FALSE)
qqline(data$Gestation, col = "steelblue", lwd = 2)
#+end_src

#+RESULTS: 653ff48a-e2d1-497d-8955-baee1b2c255d

#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-550404d0b71595254e21695ba86440cb.png]]

**** Ajustando curvas
#+NAME: 2b8af2e3-2e80-401b-9fe9-76c7fa7be849
#+begin_src ein-r :session localhost :results output :eval
b <- ggplot(data, aes(x = data$Birthweight, y = data$Gestation))
# Scatter plot with regression line
b + geom_point()+
  geom_smooth(method = "lm") 
     
# Add a loess smoothed fit curve
b + geom_point()+
  geom_smooth(method = "loess") 
#+end_src

#+RESULTS: 2b8af2e3-2e80-401b-9fe9-76c7fa7be849

***** Ajuste linear (lm)
#+ATTR_HTML: :width 300px
[[file:ein-images/ob-ein-889450cb1345d5cfe87334bcbd117717.png]]

***** Ajuste suave (loess - local polynomial regression) 
#+ATTR_HTML: :width 300px
[[file:ein-images/ob-ein-703df82527561ee011f560b12b88c740.png]]


*** Biblioteca ggpubr

#+NAME: f7a4beb7-8172-4a8b-aa39-9810ca7ee928
#+begin_src ein-r :session localhost :results output :eval
install.packages("ggpubr")
#+end_src

#+RESULTS: f7a4beb7-8172-4a8b-aa39-9810ca7ee928
: 

#+NAME: 5a48038a-d96b-4165-ad7e-9711e73c2b7e
#+begin_src ein-r :session localhost :results output :eval
  library(ggpubr)
#+end_src

#+RESULTS: 5a48038a-d96b-4165-ad7e-9711e73c2b7e


#+NAME: 467427d1-ab90-4780-8e0e-2e52d5e4084f
#+begin_src ein-r :session localhost :results output :eval
  qqPlot(data$Gestation, data$Birthweight, xlab = "test x", ylab = "test y", main = "Q-Q Plot")
#+end_src

#+RESULTS: 467427d1-ab90-4780-8e0e-2e52d5e4084f
: Error in qqPlot(data$Gestation, data$Birthweight, xlab = "test x", ylab = "test y", : could not find function "qqPlot"
: Traceback:

** Testar hipóteses visualmente com histogramas
*** *mães fumantes durante a gestação diveram bebês mais leves?*

*Da documentação:*
#+begin_quote
Gestation Smoker: fumante durante gestação 
#+end_quote

#+NAME: 96bab525-9ee7-45b3-b34a-c97d4ed236fd
#+begin_src ein-r :session localhost :results output :eval
  ggplot(data, aes(x = Birthweight, fill = factor(smoker)))+
    geom_histogram(binwidth=0.3)+
    xlab("Birthweight (libras)") +
    ylab("Contagem total") +
    labs(fill="fumante")

  ## geom_bar(width = 0.5) +
#+end_src

**** Binwidth=0.3
#+ATTR_HTML: :width 500px
 [[file:ein-images/ob-ein-10ec963b3373aa3a2d0e93e5eb0f6c1b.png]]

**** Binwidth=0.5
#+ATTR_HTML: :width 300px
[[file:ein-images/ob-ein-aae3f3da9b32aee0cdbdc2a195d31284.png]]

Observamos que o peso dos bebês de não-fumantes (=0=) caem próximos de
uma faixa bem definida. Em contra-partida há uma varição muito maior,
e principalmente negativamente relacionada ao peso, de gestoras
fumantes.

**** Teste de hipótese nas duas distribuições
- Média diferentes?
  + t-teste

** StepAIC (seleção e redução de variáveis)
*** Regressão com todas variáveis
#+begin_src ein-r :session localhost :results output :eval
  modreg_trein <- lm(Birthweight ~ . , data)
#+end_src
*** Regressão passo-a-passo, filtro AIC
#+begin_src ein-r :session localhost :results output :eval :exports both :eval
  library(MASS)
#+end_src

#+RESULTS: 2a9c6b83-520d-40c3-a56f-52df66b075d6

#+NAME: 536d4c15-9e78-4dc3-a062-346efed9454c
#+begin_src ein-r :session localhost :results output :eval :exports both :eval
  stepAIC(modreg_trein, direction="both", keep=NULL)
#+end_src

*Resultado*: fórmula reduzida.

*** Regressão com variáveis reduzidas

#+begin_src ein-r :session localhost :results output :eval
modreg_trein <- lm(formula-reduzida , data)
#+end_src

** Teste de normalidade (Shapiro)
#+begin_src ein-r :session localhost :results output :eval
  shapiro.test(modreg_trein_AIC$residuals)
#+end_src

** Regressão linear
#+begin_src ein-r :session localhost :results output :eval
  lm(formula-reduzida , data)
#+end_src

 
*** Coeficientes
\begin{equation}
\begin{aligned}
\text{peso} = a_1 * x_1 + a_2 * x_2 + \ldots \\
\end{aligned}
\end{equation}

* Scatterplots
*Fontes de consulta*:
- https://www.r-graph-gallery.com/199-correlation-matrix-with-ggally.html
  
** Dois a dois
*** Biblioteca GGally
#+NAME: ee1b3c22-7424-41e3-8028-21f250d765a2
#+begin_src ein-r :session localhost :results output :eval
  install.packages("GGally")  # Install GGally package
#+end_src

#+RESULTS: ee1b3c22-7424-41e3-8028-21f250d765a2
: 

#+NAME: c1c78b72-7184-4db5-bd3b-632584278859
#+begin_src ein-r :session localhost :results output :eval
  library("GGally")
#+end_src

#+RESULTS: c1c78b72-7184-4db5-bd3b-632584278859
: 

*** Comando =ggpairs=

#+NAME: e24bc2b8-743a-48fa-bc5a-0405789278a3
#+begin_src ein-r :session localhost :results output :eval
  ggpairs(data, title="Scatter dois a dois")
#+end_src

#+RESULTS: e24bc2b8-743a-48fa-bc5a-0405789278a3
 [[file:ein-images/ob-ein-f9dbc589da7a00230cfde52c75e74717.png]]

#+ATTR_HTML: :width 500px
[[file:ein-images/ob-ein-f9dbc589da7a00230cfde52c75e74717.png]]

** Plot colorindo por níveis de uma classe

#+NAME: c39935b6-6040-4cad-8b71-f5e2f9f69bb7
#+begin_src ein-r :session localhost :results output
  data_pairs <- data
  data_pairs$smoker <- as.factor(data$smoker)
  data_pairs$mage35 <- as.factor(data_pairs$mage35)
#+end_src

#+RESULTS: c39935b6-6040-4cad-8b71-f5e2f9f69bb7

#+NAME: 424850ce-4b3f-4cdc-baa1-bc407975a106
#+begin_src ein-r :session localhost :results output
summary(data_pairs)
#+end_src

#+RESULTS: 424850ce-4b3f-4cdc-baa1-bc407975a106
#+begin_example
       ID             Length       Birthweight       Headcirc   
 Min.   :  27.0   Min.   :43.00   Min.   :1.920   Min.   :30.0  
 1st Qu.: 537.2   1st Qu.:50.00   1st Qu.:2.940   1st Qu.:33.0  
 Median : 821.0   Median :52.00   Median :3.295   Median :34.0  
 Mean   : 894.1   Mean   :51.33   Mean   :3.313   Mean   :34.6  
 3rd Qu.:1269.5   3rd Qu.:53.00   3rd Qu.:3.647   3rd Qu.:36.0  
 Max.   :1764.0   Max.   :58.00   Max.   :4.570   Max.   :39.0  
   Gestation     smoker      mage           mnocig          mheight     
 Min.   :33.00   0:20   Min.   :18.00   Min.   : 0.000   Min.   :149.0  
 1st Qu.:38.00   1:22   1st Qu.:20.25   1st Qu.: 0.000   1st Qu.:161.0  
 Median :39.50          Median :24.00   Median : 4.500   Median :164.5  
 Mean   :39.19          Mean   :25.55   Mean   : 9.429   Mean   :164.5  
 3rd Qu.:41.00          3rd Qu.:29.00   3rd Qu.:15.750   3rd Qu.:169.5  
 Max.   :45.00          Max.   :41.00   Max.   :50.000   Max.   :181.0  
     mppwt            fage          fedyrs          fnocig         fheight     
 Min.   :45.00   Min.   :19.0   Min.   :10.00   Min.   : 0.00   Min.   :169.0  
 1st Qu.:52.25   1st Qu.:23.0   1st Qu.:12.00   1st Qu.: 0.00   1st Qu.:175.2  
 Median :57.00   Median :29.5   Median :14.00   Median :18.50   Median :180.5  
 Mean   :57.50   Mean   :28.9   Mean   :13.67   Mean   :17.19   Mean   :180.5  
 3rd Qu.:62.00   3rd Qu.:32.0   3rd Qu.:16.00   3rd Qu.:25.00   3rd Qu.:184.8  
 Max.   :78.00   Max.   :46.0   Max.   :16.00   Max.   :50.00   Max.   :200.0  
     lowbwt       mage35
 Min.   :0.0000   0:38  
 1st Qu.:0.0000   1: 4  
 Median :0.0000         
 Mean   :0.1429         
 3rd Qu.:0.0000         
 Max.   :1.0000         
#+end_example


#+NAME: 3efe76b8-acb0-4c02-b52d-da2011318917
#+begin_src ein-r :session localhost :results output
  ggpairs(data_pairs, columns=c('Birthweight','Length', 'Headcirc', 'Gestation','mppwt','fheight','smoker','mage35'), title="Scatter dois a dois, colorido pelo fator smoker", ggplot2::aes(colour=as.factor(smoker)))
  ## 
#+end_src

#+ATTR_HTML: :width 300px
[[file:ein-images/ob-ein-5736440b83a9cd2c97375d67e3487ccd.png]]
# [[file:ein-images/ob-ein-22db3a939786ea769224fe321e70b844.png]]
# [[file:ein-images/ob-ein-ebdd1cd8a64aeb94e65d3b30115843af.png]]

*** =color=as.factor(smoker)=
#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-30e2f766c8dd1a79d623ce6c4b76653b.png]]

*** =color=as.factor(!smoker)=
#+ATTR_HTML: :width 200px
[[file:ein-images/ob-ein-8925998916addb595237676b4adfbee6.png]]

* Plots scatter com marginais
** Biblioteca ggExtra

#+begin_src ein-r :session localhost :results output :eval
install.packages("ggExtra")
#+end_src

#+NAME: bf2fce52-7c0c-4521-862f-e6539ccfc5fc
#+begin_src ein-r :session localhost :results output :eval
library(ggplot2)
library(ggExtra)
#+end_src

#+RESULTS: bf2fce52-7c0c-4521-862f-e6539ccfc5fc

** Exemplos

#+NAME: 01521e91-66d8-42ec-8730-a3a48b5cddf7
#+begin_src ein-r :session localhost :results output :eval
  ## classic plot : data$Gestation, data$Birthweight
  p <- ggplot(data, aes(x=data$Gestation, y=data$Birthweight, color=smoker, fill="slateblue")) +
    geom_point() +
    ## ggtitle("Gestação vs Peso ao Nascimento")+
    theme(legend.position="none")  ## plot.title = element_text(hjust = 0.5)
#+end_src

#+RESULTS: 01521e91-66d8-42ec-8730-a3a48b5cddf7

*** Histogramas
#+NAME: 95688862-c41e-4c64-9a96-7d4299c8716e
#+begin_src ein-r :session localhost :results output :eval
  ## with marginal histogram
  p1 <- ggMarginal(p, type="histogram",  fill="slateblue", colour="red")
  p1
#+end_src

**** Sem distinção em =p= entre fumantes/não-fumantes
#+ATTR_HTML: :width 300px
[[file:ein-images/ob-ein-4df43508948ef9c3e19bbab177fad680.png]]

**** Com distinção; marginal padrão cinza
#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-f845c6524c9cb33170870fca97a40393.png]]

**** Marginal com =fill=
#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-83ae539957e7f7b2c3fd8e0acd0d3bdb.png]]

**** Marginal com =fill= e =colour=
#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-222cada0e8aaf0b329a002d68a2ee807.png]]

*** Density
#+NAME: 52977ed1-1329-4c37-a0ef-17bf8164fed6
#+begin_src ein-r :session localhost :results output :eval
  ## marginal density
  p2 <- ggMarginal(p, type="density")
  p2
#+end_src

#+RESULTS: 52977ed1-1329-4c37-a0ef-17bf8164fed6
: 
: 
: 
:
#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-ce5b7982e3b19d7ee855788e14700b26.png]]

*** Boxplot
#+NAME: 046bfe4d-c371-46f9-8326-a3f34623357e
#+begin_src ein-r :session localhost :results output :eval
  ## marginal boxplot
  p3 <- ggMarginal(p, type="boxplot")
  p3
#+end_src

#+RESULTS: 046bfe4d-c371-46f9-8326-a3f34623357e
: 
: 
: 
:

#+ATTR_HTML: :width 300px
 [[file:ein-images/ob-ein-6550f637557caa9f4c19dcbb905d347f.png]]



